<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é–å¯¬é–å»£ â€” åŒ…æ£Ÿé è¨‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial,"Microsoft JhengHei";
        background: #f2f2f2;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        padding: 26px;
        border-radius: 16px;
        margin-top: 20px;
    }

    h2 {
        text-align: center;
        color: #06c755;
        font-size: 28px;
        margin-bottom: 30px;
    }

    label {
        font-size: 22px;
        font-weight: bold;
        display: block;
        margin-top: 20px;
    }

    select, input, textarea {
        width: 100%;
        padding: 20px;
        font-size: 20px;
        margin-top: 10px;
        border-radius: 12px;
        border: 1px solid #ccc;
    }

    button {
        width: 100%;
        padding: 22px;
        font-size: 24px;
        background: #06c755;
        color: white;
        border: none;
        border-radius: 14px;
        margin-top: 30px;
        cursor: pointer;
        font-weight: bold;
    }

    button:active {
        opacity: 0.8;
    }

    .disabled-date {
        background: #ddd;
        color: #aaa;
        pointer-events: none;
    }
</style>
</head>

<body>

<div class="container">
    <h2>é–å¯¬é–å»£ â€” åŒ…æ£Ÿé è¨‚</h2>

    <!-- é¤¨åˆ¥ -->
    <label>ğŸ¡ é¤¨åˆ¥ï¼ˆå¿…å¡«ï¼‰</label>
    <select id="house" required onchange="loadDisabledDates()">
        <option value="">è«‹é¸æ“‡é¤¨åˆ¥</option>
        <option value="Aé¤¨">Aé¤¨</option>
        <option value="Bé¤¨">Bé¤¨</option>
    </select>

    <!-- åŒ…æ£Ÿæ—¥æœŸ -->
    <label>ğŸ“… åŒ…æ£Ÿæ—¥æœŸï¼ˆå¿…å¡«ï¼‰</label>
    <input type="date" id="date" required />

    <!-- åŒ…æ£Ÿå¤©æ•¸ -->
    <label>ğŸŒ™ åŒ…æ£Ÿå¤©æ•¸</label>
    <select id="days">
        <option value="1">1 æ™š</option>
        <option value="2">2 æ™š</option>
        <option value="3">3 æ™š</option>
    </select>

    <!-- å§“å -->
    <label>ğŸ‘¤ å§“åï¼ˆå¿…å¡«ï¼‰</label>
    <input id="name" required />

    <!-- æ‰‹æ©Ÿ -->
    <label>ğŸ“± æ‰‹æ©Ÿï¼ˆå¿…å¡«ï¼‰</label>
    <input id="phone" type="tel" required />

    <!-- å¤§äºº -->
    <label>ğŸ§‘ å¤§äººï¼ˆå¿…å¡«ï¼‰</label>
    <select id="adult" required>
        <option value="">è«‹é¸æ“‡</option>
        <script>
            for (let i = 6; i <= 25; i++) {
                document.write(`<option value="${i}">${i} ä½</option>`);
            }
        </script>
    </select>

    <!-- å°å­© -->
    <label>ğŸ§’ å°å­©</label>
    <select id="child">
        <script>
            for (let i = 0; i <= 10; i++) {
                document.write(`<option value="${i}">${i} ä½</option>`);
            }
        </script>
    </select>

    <!-- å¯µç‰© -->
    <label>ğŸ¶ å¯µç‰©</label>
    <select id="pet">
        <option value="ç„¡">ç„¡</option>
        <option value="æœ‰">æœ‰</option>
    </select>

    <!-- å‚™è¨» -->
    <label>ğŸ“ éœ€æ±‚å…§å®¹ï¼ˆå‚™è¨»ï¼‰</label>
    <textarea id="note" rows="3"></textarea>

    <!-- é€å‡º -->
    <button onclick="submitForm()">é€å‡ºé è¨‚è³‡æ–™</button>
</div>


<script>
/* â˜…â˜…â˜… ä½ çš„ GAS API URL â˜…â˜…â˜… */
const API_URL = "https://script.google.com/macros/s/AKfycbz5HEyUZi1MskWO4LRaEuBUfU03KX_9QxCI4DgcDcI7PwXB8J3tpV6GKZoJoNzuwjb7/exec";

let disabledDates = [];  // å„²å­˜å·²æ»¿æ—¥æœŸ

/* ----------------------------------------------------
   æ ¹æ“šé¤¨åˆ¥è¼‰å…¥å·²æ»¿æ—¥æœŸ
---------------------------------------------------- */
async function loadDisabledDates() {
    const house = document.getElementById("house").value;
    const dateInput = document.getElementById("date");

    if (!house) {
        disabledDates = [];
        dateInput.disabled = true;
        dateInput.value = "";
        return;
    }

    dateInput.disabled = false;

    const res = await fetch(API_URL + "?action=getRoomStatus");
    const data = await res.json();

    disabledDates = data[house] || [];

    dateInput.value = "";
    dateInput.setAttribute("min", today());
}

/* ----------------------------------------------------
   æ—¥æœŸè®Šæ›´ â†’ æª¢æŸ¥æ˜¯å¦æ˜¯æ»¿æˆ¿
---------------------------------------------------- */
document.getElementById("date").addEventListener("change", function() {
    if (disabledDates.includes(this.value)) {
        alert("âš  æ­¤æ—¥æœŸå·²æ»¿æˆ¿ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸ");
        this.value = "";
    }
});

/* ----------------------------------------------------
   ä»Šæ—¥æ—¥æœŸ
---------------------------------------------------- */
function today() {
    const d = new Date();
    return d.toISOString().split("T")[0];
}

/* ----------------------------------------------------
   é€å‡ºè¡¨å–® â†’ å°å‘ resultSend.html
---------------------------------------------------- */
function submitForm() {
    const house = document.getElementById("house").value;
    const date = document.getElementById("date").value;
    const days = document.getElementById("days").value;
    const name = document.getElementById("name").value;
    const phone = document.getElementById("phone").value;
    const adult = document.getElementById("adult").value;
    const child = document.getElementById("child").value;
    const pet = document.getElementById("pet").value;
    const note = document.getElementById("note").value;

    if (!house || !date || !name || !phone || !adult) {
        alert("è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½");
        return;
    }

    const params = new URLSearchParams({
        house, date, days, name, phone, adult, child, pet, note
    });

    window.location.href = "resultSend.html?" + params.toString();
}
</script>

</body>
</html>
