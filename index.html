<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LINE 預訂表單</title>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- Ultra MAX CSS -->
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      margin: 0;
      padding: 0;
      background: #ffffff;
      font-size: 30px;
    }

    .container {
      width: 100%;
      padding: 40px 28px;
      box-sizing: border-box;
    }

    h2 {
      font-size: 40px;
      font-weight: 900;
      color: #222;
      margin-top: 10px;
      margin-bottom: 50px;
    }

    .field-group {
      margin-bottom: 40px;
    }

    .field-group label {
      font-size: 30px;
      margin-bottom: 18px;
      display: block;
      font-weight: 700;
      color: #333;
    }

    .field-group input,
    .field-group textarea,
    .field-group select {
      width: 100%;
      padding: 34px;
      font-size: 30px;
      border: 1px solid #ccc;
      border-radius: 18px;
      background: #f7f7f7;
      box-sizing: border-box;
    }

    select { appearance: none; }
    select::-ms-expand { display: none; }

    button {
      width: 100%;
      padding: 36px 0;
      font-size: 34px;
      font-weight: 900;
      background: #06c755;
      color: white;
      border: none;
      border-radius: 24px;
      cursor: pointer;
      margin-top: 20px;
    }
  </style>
</head>

<body>

<div class="container">
  <h2>請填寫以下資料</h2>

  <form id="liffForm">
    <input type="hidden" id="line_uid">

    <!-- 館別（自動帶入） -->
    <div class="field-group">
      <label>館別</label>
      <select id="house" required disabled>
        <option value="A館">A館</option>
        <option value="B館">B館</option>
      </select>
    </div>

    <!-- 包棟日期 -->
    <div class="field-group">
      <label>包棟日期</label>
      <input type="date" id="date" required />
    </div>

    <!-- 包棟天數 -->
    <div class="field-group">
      <label>包棟天數</label>
      <select id="days">
        <option value="1">1 晚</option>
        <option value="2">2 晚</option>
        <option value="3">3 晚</option>
      </select>
    </div>

    <!-- 姓名 -->
    <div class="field-group">
      <label>姓名（必填）</label>
      <input type="text" id="name" required />
    </div>

    <!-- 手機 -->
    <div class="field-group">
      <label>手機號碼（必填）</label>
      <input
        type="tel"
        id="phone"
        required
        placeholder="例如：0912345678"
        pattern="09[0-9]{8}"
        maxlength="10"
        inputmode="numeric"
      />
    </div>

    <!-- 大人 -->
    <div class="field-group">
      <label>大人人數（必填）</label>
      <select id="adult" required>
        <option value="" disabled selected>請選擇</option>
        <script>
          for (let i = 6; i <= 25; i++) {
            document.write(`<option value="${i}">${i} 位</option>`);
          }
        </script>
      </select>
    </div>

    <!-- 小孩 -->
    <div class="field-group">
      <label>小孩人數（必填）</label>
      <select id="child" required>
        <script>
          for (let i = 0; i <= 10; i++) {
            document.write(`<option value="${i}">${i} 位</option>`);
          }
        </script>
      </select>
    </div>

    <!-- 寵物 -->
    <div class="field-group">
      <label>有無寵物</label>
      <select id="pet">
        <option value="無">無</option>
        <option value="有">有</option>
      </select>
    </div>

    <!-- 備註 -->
    <div class="field-group">
      <label>需求內容</label>
      <textarea id="note" rows="3"></textarea>
    </div>

    <button type="submit">送出資料</button>
  </form>

</div>

<script>
// === 常數設定 ===
const LIFF_ID = "2008409020-k4Oy7Y0D";

// === LIFF 初始化 + URL 檢查 + 自動帶入欄位 ===
async function init() {
  // 1. 初始化 LIFF
  await liff.init({ liffId: LIFF_ID });

  // 2. 未登入就登入（帶上目前網址，保留 ?house=&date=）
  if (!liff.isLoggedIn()) {
    liff.login({ redirectUri: window.location.href });
    return;
  }

  // 3. 取得網址參數
  const url = new URL(location.href);
  const house = url.searchParams.get("house");
  const date  = url.searchParams.get("date");

  // 4. 如果沒有 house / date，再導回日曆（這時候已經是登入後，不會來回跳）
  if (!house || !date) {
    window.location.href = "customer-calendar.html";
    return;
  }

  // 5. 帶入館別 & 日期
  const houseSelect = document.getElementById("house");
  const dateInput   = document.getElementById("date");
  if (houseSelect) houseSelect.value = house;
  if (dateInput)   dateInput.value   = date;

  // 6. 抓 LINE 使用者資料（UID + 可選：顯示名稱）
  const profile = await liff.getProfile();
  document.getElementById("line_uid").value = profile.userId;

  // 如果你想順便把 LINE 名稱帶到姓名欄位，也可以加這段：
  const nameInput = document.getElementById("name");
  if (nameInput && !nameInput.value) {
    nameInput.value = profile.displayName || "";
  }
}

// DOM 載完後執行初始化
document.addEventListener("DOMContentLoaded", init);


// === 提交表單 ===
document.getElementById("liffForm").addEventListener("submit", function(e) {
  e.preventDefault();

  // 手機格式清洗
  let phone = document.getElementById("phone").value;
  phone = phone.replace(/[^0-9]/g, "");

  if (!/^09\d{8}$/.test(phone)) {
    alert("⚠ 手機格式錯誤，必須為 09 開頭、共 10 碼");
    return;
  }

  document.getElementById("phone").value = phone;

  const params = new URLSearchParams();
  params.append("house", document.getElementById("house").value);
  params.append("date",  document.getElementById("date").value);
  params.append("days",  document.getElementById("days").value);
  params.append("name",  document.getElementById("name").value);
  params.append("phone", phone);
  params.append("adult", document.getElementById("adult").value);
  params.append("child", document.getElementById("child").value);
  params.append("pet",   document.getElementById("pet").value);
  params.append("note",  document.getElementById("note").value);
  params.append("uid",   document.getElementById("line_uid").value);

  window.location.href = "resultSend.html?" + params.toString();
});
</script>


</body>
</html>
