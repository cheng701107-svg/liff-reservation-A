<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è³‡æ–™é€å‡ºä¸­...</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
    body {
        font-family: Arial, "Microsoft JhengHei";
        background: #f2f2f2;
        text-align: center;
        padding: 40px;
        font-size: 22px;
    }
</style>
</head>

<body>
<p id="status">ğŸ“¤ æ­£åœ¨è™•ç†æ‚¨çš„é è¨‚ï¼Œè«‹ç¨å€™â€¦</p>

<script>
/* â˜…â˜…â˜… ä½ çš„ GAS API â˜…â˜…â˜… */
const API_URL =
 "https://script.google.com/macros/s/AKfycbz5HEyUZi1MskWO4LRaEuBUfU03KX_9QxCI4DgcDcI7PwXB8J3tpV6GKZoJoNzuwjb7/exec";

async function main() {
    try {

        /* ----------------------------------------------------
           LIFF åˆå§‹åŒ–
        ---------------------------------------------------- */
        await liff.init({ liffId: "2008409020-k4Oy7Y0D" });

        if (!liff.isLoggedIn()) {
            liff.login({ redirectUri: window.location.href });
            return;
        }

        /* ----------------------------------------------------
           å–å¾— URL å‚³å…¥åƒæ•¸
        ---------------------------------------------------- */
        const url = new URL(location.href);

        const house    = url.searchParams.get("house");
        const date     = url.searchParams.get("date");
        const days     = url.searchParams.get("days");
        const name     = url.searchParams.get("name");
        const phone    = url.searchParams.get("phone");
        const adult    = url.searchParams.get("adult");
        const child    = url.searchParams.get("child");
        const pet      = url.searchParams.get("pet");
        const note     = url.searchParams.get("note") || "";

        // â˜… æ–°å¢ï¼šå¾ URL å–å¾— uid / email / lineName
        const uid      = url.searchParams.get("uid")      || "";
        const email    = url.searchParams.get("email")    || "";
        const lineName = url.searchParams.get("lineName") || "";

        /* ç¼ºè³‡æ–™æ™‚åœä¸‹ä¾†é¿å…ç©ºå€¼å¯«å…¥ GAS */
        if (!house || !date || !name || !phone) {
            document.getElementById("status").innerText =
                "é€å‡ºè³‡æ–™å¤±æ•—ï¼šå¿…è¦æ¬„ä½ä¸å®Œæ•´ï¼Œè«‹è¿”å›é‡æ–°å¡«å¯«ã€‚";
            return;
        }

        /* ----------------------------------------------------
           çµ„åˆè³‡æ–™ï¼ˆé€çµ¦ GASï¼‰
        ---------------------------------------------------- */
        const body = {
            action:    "add",
            admin_key: "admin2025",
            uid,          // user-id
            email,        // E-mail
            lineName,     // Line åç¨±
            house,
            date,
            days,
            name,
            phone,
            adult,
            child,
            pet,
            note
        };

        /* ----------------------------------------------------
           é€å‡ºè³‡æ–™åˆ° Google Sheet
           ğŸ‘‰ é‡é»ï¼šä¸è¦åŠ  headersã€åŠ ä¸Š mode:"no-cors"
        ---------------------------------------------------- */
        try {
            await fetch(API_URL, {
                method: "POST",
                body: JSON.stringify(body),
                mode: "no-cors"
            });
            console.log("âœ… å·²å°‡è³‡æ–™é€åˆ° GAS");
        } catch (e) {
            console.error("é€åˆ° GAS å¤±æ•—ï¼š", e);
            document.getElementById("status").innerText =
                "â— ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼ˆå¯«å…¥å¤±æ•—ï¼‰ï¼š" + e.message;
            return;
        }

        /* ----------------------------------------------------
           å¯«å…¥æˆåŠŸï¼ˆå‡è¨­æˆåŠŸï¼‰â†’ å›å‚³è¨Šæ¯çµ¦ä½¿ç”¨è€…
        ---------------------------------------------------- */
        const msg =
`ğŸ“˜ æ‚¨çš„é è¨‚å·²æ”¶åˆ°ï¼

ğŸ‘¤ å§“åï¼š${name}
