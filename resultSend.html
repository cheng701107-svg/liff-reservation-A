<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>è³‡æ–™é€å‡ºä¸­...</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
    body {
        font-family: Arial, "Microsoft JhengHei";
        background: #f2f2f2;
        text-align: center;
        padding: 40px;
        font-size: 22px;
    }
</style>
</head>

<body>
<p id="status">ğŸ“¤ æ­£åœ¨è™•ç†æ‚¨çš„é è¨‚ï¼Œè«‹ç¨å€™â€¦</p>

<script>
/* â˜…â˜…â˜… ä½ çš„ GAS API â˜…â˜…â˜… */
const API_URL =
 "https://script.google.com/macros/s/AKfycbz5HEyUZi1MskWO4LRaEuBUfU03KX_9QxCI4DgcDcI7PwXB8J3tpV6GKZoJoNzuwjb7/exec";

async function main() {
    try {

        /* ----------------------------------------------------
           LIFF åˆå§‹åŒ–
        ---------------------------------------------------- */
        await liff.init({ liffId: "2008409020-k4Oy7Y0D" });

        if (!liff.isLoggedIn()) {
            liff.login();
            return;
        }

        /* ----------------------------------------------------
           å–å¾— URL å‚³å…¥åƒæ•¸
        ---------------------------------------------------- */
        const url = new URL(location.href);

        const house = url.searchParams.get("house");
        const date  = url.searchParams.get("date");
        const days  = url.searchParams.get("days");
        const name  = url.searchParams.get("name");
        const phone = url.searchParams.get("phone");
        const adult = url.searchParams.get("adult");
        const child = url.searchParams.get("child");
        const pet   = url.searchParams.get("pet");
        const note  = url.searchParams.get("note") || "";

        /* ç¼ºè³‡æ–™æ™‚åœä¸‹ä¾†é¿å…ç©ºå€¼å¯«å…¥ GAS */
        if (!house || !date || !name || !phone) {
            document.getElementById("status").innerText =
                "é€å‡ºè³‡æ–™å¤±æ•—ï¼šå¿…è¦æ¬„ä½ä¸å®Œæ•´ï¼Œè«‹è¿”å›é‡æ–°å¡«å¯«ã€‚";
            return;
        }

        /* ----------------------------------------------------
           çµ„åˆè³‡æ–™
        ---------------------------------------------------- */
        const body = {
            action: "add",
            admin_key: "admin2025",
            house,
            date,
            days,
            name,
            phone,
            adult,
            child,
            pet,
            note
        };

        /* ----------------------------------------------------
           é€å‡ºè³‡æ–™åˆ° Google Sheetï¼ˆå« headersï¼‰
        ---------------------------------------------------- */
        const res = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },   // â˜… å¿…åŠ ï¼
            body: JSON.stringify(body)
        });

        if (!res.ok) throw new Error("GAS API é€£ç·šå¤±æ•—");

        const json = await res.json();

        if (!json.success) {
            document.getElementById("status").innerText =
                "â— å¯«å…¥è³‡æ–™åº«å¤±æ•—ï¼š" + JSON.stringify(json);
            return;
        }

        /* ----------------------------------------------------
           å¯«å…¥æˆåŠŸ â†’ å›å‚³è¨Šæ¯çµ¦ä½¿ç”¨è€…
        ---------------------------------------------------- */
        const msg =
`ğŸ“˜ æ‚¨çš„é è¨‚å·²æ”¶åˆ°ï¼

ğŸ‘¤ å§“åï¼š${name}
ğŸ“± æ‰‹æ©Ÿï¼š${phone}
ğŸ¡ é¤¨åˆ¥ï¼š${house}
ğŸ“… åŒ…æ£Ÿæ—¥æœŸï¼š${date}
ğŸŒ™ åŒ…æ£Ÿå¤©æ•¸ï¼š${days} æ™©
ğŸ§‘â€ğŸ§‘â€ğŸ§’ å¤§äººï¼š${adult} ä½
ğŸ§’ å°å­©ï¼š${child} ä½
ğŸ¶ å¯µç‰©ï¼š${pet}
ğŸ“ å‚™è¨»ï¼š
${note || "ç„¡"}

æˆ‘å€‘æœƒç›¡å¿«èˆ‡æ‚¨è¯ç¹«ï¼Œè¬è¬æ‚¨ï¼`;

        await liff.sendMessages([{ type: "text", text: msg }]);

        /* ----------------------------------------------------
           å®Œæˆ â†’ é—œé–‰è¦–çª—
        ---------------------------------------------------- */
        liff.closeWindow();

    } catch (err) {
        console.error(err);
        document.getElementById("status").innerText =
            "â— ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message;
    }
}

main();
</script>

</body>
</html>
