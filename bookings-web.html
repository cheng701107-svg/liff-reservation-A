<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>è¨‚æˆ¿ç´€éŒ„æŸ¥è©¢ - é–å¯¬æ°‘å®¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    font-family: "Noto Sans TC","Microsoft JhengHei", sans-serif;
    margin: 0;
    background: #f5f5f5;
  }

  header {
    background: #06c755;
    color: #fff;
    padding: 16px;
    text-align: center;
    font-size: 22px;
    font-weight: 900;
  }

  .container {
    max-width: 560px;
    margin: 0 auto;
    padding: 16px;
  }

  .card {
    background: #fff;
    border-radius: 16px;
    padding: 14px 16px;
    margin-top: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }

  .title {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 4px;
    color: #333;
  }

  .row {
    font-size: 14px;
    margin-bottom: 4px;
    color: #444;
  }

  .status {
    margin-top: 6px;
    font-weight: 700;
    font-size: 14px;
  }

  .status-ok { color: #06c755; }
  .status-wait { color: #f57c00; }
  .status-cancel { color: #d32f2f; }

  .input-area {
    margin: 18px 0;
  }

  input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  .btn {
    width: 100%;
    padding: 14px;
    background: #06c755;
    color: #fff;
    border: none;
    border-radius: 999px;
    font-size: 16px;
    font-weight: 700;
    margin-top: 12px;
    cursor: pointer;
  }

  .btn:disabled {
    background: #9e9e9e;
  }

  #result {
    margin-top: 16px;
  }
</style>
</head>

<body>

<header>è¨‚æˆ¿ç´€éŒ„æŸ¥è©¢</header>

<div class="container">

  <div class="input-area">
    <label style="font-weight:700;">è«‹è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿè™Ÿç¢¼ï¼š</label>
    <input id="phone" type="tel" placeholder="0912345678" maxlength="10" />
    <button class="btn" id="btnSearch">æŸ¥è©¢</button>
  </div>

  <div id="result">è«‹å…ˆè¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼é€²è¡ŒæŸ¥è©¢ã€‚</div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxAhWFD3rLv2O1RSnmEA3EJjXIK5vFKja4IHGtL8EW3q-6ZD77K1Emc_ryFAK1fOZKA/exec";

/* ç‹€æ…‹é¡è‰² */
function statusClass(s) {
  if (!s) return "status-wait";
  s = s.trim();
  if (["å·²è¨‚æˆ¿", "å·²ç¢ºèª", "å·²å…¥ä½", "å®Œæˆ"].includes(s)) return "status-ok";
  if (["å¾…ç¢ºèª", "è™•ç†ä¸­"].includes(s)) return "status-wait";
  if (["å·²å–æ¶ˆ", "å–æ¶ˆ"].includes(s)) return "status-cancel";
  return "status-wait";
}

/* æœå°‹äº‹ä»¶ */
document.getElementById("btnSearch").addEventListener("click", loadBookings);

async function loadBookings() {
  const phone = document.getElementById("phone").value.trim();
  const result = document.getElementById("result");

  if (!/^09\d{8}$/.test(phone)) {
    result.innerHTML = "<p style='color:#d32f2f;'>æ‰‹æ©Ÿæ ¼å¼å¿…é ˆç‚º 09xxxxxxxx</p>";
    return;
  }

  result.innerHTML = "æŸ¥è©¢ä¸­â€¦";

  try {
    const res = await fetch(`${API_URL}?action=getWebBookings&phone=${phone}&ts=${Date.now()}`);
    const json = await res.json();

    if (!json.success) {
      result.innerHTML = `<p style='color:#d32f2f;'>æŸ¥è©¢å¤±æ•—ï¼š${json.error}</p>`;
      return;
    }

    let items = json.bookings || [];

    /* ğŸ”¥ è‡ªå‹•æ’é™¤å–æ¶ˆè¨‚å–®ï¼ˆä½ æŒ‡å®šçš„ B æ¨¡å¼ï¼‰ */
    items = items.filter(b => !["å–æ¶ˆ","å·²å–æ¶ˆ"].includes(b.status));

    if (items.length === 0) {
      result.innerHTML = "<p>æ‰¾ä¸åˆ°æ­¤æ‰‹æ©Ÿçš„è¨‚æˆ¿ç´€éŒ„ã€‚</p>";
      return;
    }

    result.innerHTML = items.map(b => `
      <div class="card">
        <div class="title">è¨‚å–®ç·¨è™Ÿï¼š${b.id}</div>
        <div class="row">å…¥ä½æ—¥æœŸï¼š${b.date}</div>
        <div class="row">é¤¨åˆ¥ï¼š${b.house}</div>
        <div class="row">ä½å®¿å¤©æ•¸ï¼š${b.nights} æ™š</div>
        <div class="row">å¤§äººï¼š${b.adult} ä½</div>
        <div class="row">å°å­©ï¼š${b.child} ä½</div>
        <div class="row">å¯µç‰©ï¼š${b.pet || "ç„¡"}</div>
        <div class="row">å‚™è¨»ï¼š${b.note || "ç„¡"}</div>
        <div class="status ${statusClass(b.status)}">ç‹€æ…‹ï¼š${b.status}</div>
      </div>
    `).join("");

  } catch (err) {
    result.innerHTML = `<p style='color:#d32f2f;'>æŸ¥è©¢éŒ¯èª¤ï¼š${err}</p>`;
  }
}
</script>

</body>
</html>
