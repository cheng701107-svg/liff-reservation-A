<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>我的訂房紀錄 - 靖寬靖廣</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
  body { font-family:"Noto Sans TC","Microsoft JhengHei"; margin:0; background:#f5f5f5; }
  header { background:#06c755; color:#fff; padding:16px; font-size:22px; font-weight:900; text-align:center; }
  .container { max-width:560px; margin:0 auto; padding:16px; }
  .card {
    background:#fff; border-radius:16px; padding:16px;
    margin-bottom:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08);
  }
  .title { font-size:16px; font-weight:700; margin-bottom:8px; }
  .row { margin-bottom:4px; font-size:14px; }
  .status { margin-top:6px; font-weight:700; }
  .status.ok { color:#06c755; }
  .status.wait { color:#f57c00; }
  .status.cancel { color:#d32f2f; }
</style>
</head>

<body>

<header>我的訂房紀錄</header>

<div class="container">
  <div id="list">讀取中…</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwyDvx82gKgUUcyP-Ke7KJw1wVA2thbiGjhb0IO1-NbEUO5CqnXaz--SPSKEYUUB5tj/exec";
const LIFF_ID = "2008409020-k4Oy7Y0D";

document.addEventListener("DOMContentLoaded", init);

async function init() {
  try {
    await liff.init({ liffId: LIFF_ID });

    if (!liff.isLoggedIn()) {
      console.log("尚未登入，進行登入");
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    const uid = profile.userId;

    console.log("取得到的 UID：", uid);

    loadBookings(uid);

  } catch (err) {
    document.getElementById("list").textContent = "LIFF 初始化失敗： " + err;
    console.error("LIFF 初始化失敗：", err);
  }
}

async function loadBookings(uid) {
  const listEl = document.getElementById("list");

  try {
    const url = `${API_URL}?action=getUserBookings&uid=${uid}&ts=${Date.now()}`;
    console.log("呼叫 API：", url);

    const res = await fetch(url);
    const json = await res.json();

    console.log("API 回傳內容：", json);

    if (!json.success) {
      listEl.textContent = "API 錯誤：" + json.error;
      return;
    }

    if (json.bookings.length === 0) {
      listEl.textContent = "目前沒有訂房紀錄。";
      return;
    }

    // 渲染 UI...

  } catch (err) {
    listEl.textContent = "讀取失敗：" + err;
    console.error("API 發生錯誤：", err);
  }
}
</script>


</body>
</html>

