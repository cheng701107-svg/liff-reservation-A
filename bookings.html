<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>我的訂房紀錄 - 靖寬靖廣</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
  body { font-family:"Noto Sans TC","Microsoft JhengHei"; margin:0; background:#f5f5f5; }
  header { background:#06c755; color:#fff; padding:16px; font-size:22px; font-weight:900; text-align:center; }
  .container { max-width:560px; margin:0 auto; padding:16px; }
  .card {
    background:#fff; border-radius:16px; padding:16px;
    margin-bottom:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08);
  }
  .title { font-size:16px; font-weight:700; margin-bottom:8px; }
  .row { margin-bottom:4px; font-size:14px; }
  .status { margin-top:6px; font-weight:700; }
  .status.ok { color:#06c755; }
  .status.wait { color:#f57c00; }
  .status.cancel { color:#d32f2f; }
</style>
</head>

<body>

<header>我的訂房紀錄</header>

<div class="container">
  <div id="list">讀取中…</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwyDvx82gKgUUcyP-Ke7KJw1wVA2thbiGjhb0IO1-NbEUO5CqnXaz--SPSKEYUUB5tj/exec";
const LIFF_ID = "2008409020-k4Oy7Y0D";

document.addEventListener("DOMContentLoaded", init);

async function init() {
  await liff.init({ liffId: LIFF_ID });
  const profile = await liff.getProfile();
  const uid = profile.userId;

  loadBookings(uid);
}

async function loadBookings(uid) {
  const res = await fetch(`${API_URL}?action=getUserBookings&uid=${uid}&ts=${Date.now()}`);
  const json = await res.json();

  const listEl = document.getElementById("list");

  if (!json.success) {
    listEl.textContent = "讀取失敗：" + json.error;
    return;
  }

  const items = json.bookings;

  if (items.length === 0) {
    listEl.textContent = "目前沒有訂房紀錄。";
    return;
  }

  listEl.innerHTML = items.map(b => `
    <div class="card">
      <div class="title">訂單編號：${b.id}</div>
      <div class="row">入住日期：${b.date}</div>
      <div class="row">住宿天數：${b.nights} 晚</div>
      <div class="row">館別：${b.house}</div>
      <div class="row">人數：大人 ${b.adult} / 小孩 ${b.child}</div>
      <div class="row">寵物：${b.pet}</div>
      <div class="row">備註：${b.note || "—"}</div>
      <div class="status ${statusColor(b.status)}">狀態：${b.status}</div>
      <div class="status">收款：${b.payment}</div>
    </div>
  `).join("");
}

function statusColor(s) {
  if (s === "已訂房" || s === "已入住") return "ok";
  if (s === "待確認") return "wait";
  return "cancel";  // 已取消
}
</script>

</body>
</html>
